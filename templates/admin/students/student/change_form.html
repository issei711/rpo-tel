{% extends "admin/change_form.html" %}
{% load i18n admin_urls static %}

{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'admin/css/change_form.css' %}">

  {# ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã«å³æ™‚ãƒ­ãƒƒã‚¯è§£é™¤ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™ #}
  <script>
    // beforeunload ã§ç¢ºå®Ÿã«å‘¼ã³å‡ºã—
    window.addEventListener('beforeunload', function() {
      if (navigator.sendBeacon) {
        navigator.sendBeacon('{{ unlock_url }}');
      } else {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '{{ unlock_url }}', false);
        xhr.send();
      }
    });
    // visibilitychange ã§ã‚‚é€ä¿¡ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç­‰ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'hidden' && navigator.sendBeacon) {
        navigator.sendBeacon('{{ unlock_url }}');
      }
    });
  </script>
{% endblock %}

{% block content %}
  <div id="student_form" class="module aligned">

    {% if original %}
      <div class="history-link-container">
        <a href="{% url 'admin:students_student_history' original.pk %}" class="btn-history">ğŸ•˜ å±¥æ­´ã‚’è¦‹ã‚‹</a>
      </div>
    {% endif %}

    <form {% if has_file_field %}enctype="multipart/form-data"{% endif %} action="" method="post" novalidate>
      {% csrf_token %}
      {{ adminform.form.non_field_errors }}

      <fieldset class="module aligned">
        <h2>{% trans "åŸºæœ¬æƒ…å ±" %}</h2>
        <table class="basic-info-table">
          <tbody>
            <tr>
              <th>{% trans "ä¼æ¥­å" %}</th>
              <td class="emphasis-cell">{{ original.company.name }}</td>
            </tr>
            <tr>
              <th>{% trans "æ°åï¼ˆã‚·ãƒ¡ã‚¤ï¼‰" %}</th>
              <td>{{ original.full_name }}ï¼ˆ{{ original.name|cut:" " }}ï¼‰</td>
            </tr>
            <tr>
              <th>{% trans "å­¦ç”ŸID" %}</th>
              <td>{{ original.data_id }}</td>
            </tr>
            <tr>
              <th>{% trans "é›»è©±ç•ªå·" %}</th>
              <td>{{ original.phone_number }}</td>
            </tr>
            <tr>
              <th>{% trans "å’å¹´åº¦ãƒ»å­¦æ ¡" %}</th>
              <td>{{ original.grad_year }}å’ {{ original.university }} {{ original.faculty }} {{ original.department }}</td>
            </tr>
            <tr>
              <th>{% trans "å¤§åˆ†é¡" %}</th>
              <td class="emphasis-cell">{{ original.major_class }}</td>
            </tr>
            <tr>
              <th>{% trans "å°åˆ†é¡" %}</th>
              <td>{{ original.minor_class }}</td>
            </tr>
            <tr>
              <th>{% trans "åˆå›ã‚¨ãƒ³ãƒˆãƒªãƒ¼çµŒè·¯" %}</th>
              <td>{{ original.process_destination }}</td>
            </tr>
            <tr>
              <th>{% trans "ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆURL" %}</th>
              <td>
                <a href="{{ talk_script_url }}" class="talk-script-link" target="_blank">ãƒªãƒ³ã‚¯</a>
              </td>
            </tr>
          </tbody>
        </table>
      </fieldset>

      <fieldset class="module call-info">
        <h2>{% trans "ã‚³ãƒ¼ãƒ«æƒ…å ±" %}</h2>
        <table class="call-table">
          <thead>
            <tr>
              <th></th><th>{% trans "æ—¥ä»˜" %}</th>
              <th>{% trans "æ™‚é–“å¸¯" %}</th><th>{% trans "çµæœ" %}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>{% trans "1ã‚³ãƒ¼ãƒ«ç›®" %}</th>
              <td>{{ adminform.form.first_call_date }}{{ adminform.form.first_call_date.errors }}</td>
              <td>{{ adminform.form.first_call_timezone }}{{ adminform.form.first_call_timezone.errors }}</td>
              <td>{{ adminform.form.first_call_notes }}{{ adminform.form.first_call_notes.errors }}</td>
            </tr>
            <tr>
              <th>{% trans "2ã‚³ãƒ¼ãƒ«ç›®" %}</th>
              <td>{{ adminform.form.second_call_date }}{{ adminform.form.second_call_date.errors }}</td>
              <td>{{ adminform.form.second_call_timezone }}{{ adminform.form.second_call_timezone.errors }}</td>
              <td>{{ adminform.form.second_call_notes }}{{ adminform.form.second_call_notes.errors }}</td>
            </tr>
            <tr>
              <th>{% trans "3ã‚³ãƒ¼ãƒ«ç›®" %}</th>
              <td>{{ adminform.form.third_call_date }}{{ adminform.form.third_call_date.errors }}</td>
              <td>{{ adminform.form.third_call_timezone }}{{ adminform.form.third_call_timezone.errors }}</td>
              <td>{{ adminform.form.third_call_notes }}{{ adminform.form.third_call_notes.errors }}</td>
            </tr>
          </tbody>
        </table>
      </fieldset>

      <fieldset class="module aligned">
        <h2>{% trans "å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹" %}</h2>
        <table class="status-table">
          <tbody>
            <tr>
              <th>{% trans "å‡¦ç†å¿…è¦" %}</th>
              <td>{{ adminform.form.need_process }}{{ adminform.form.need_process.errors }}</td>
            </tr>
            <tr>
              <th>{% trans "Wãƒã‚§å¿…è¦" %}</th>
              <td>{{ adminform.form.done_draft }}{{ adminform.form.done_draft.errors }}</td>
            </tr>
            <tr>
              <th>{% trans "TELçµ‚äº†/å‡¦ç†æ¸ˆ" %}</th>
              <td>{{ adminform.form.done_tel }}{{ adminform.form.done_tel.errors }}</td>
            </tr>
          </tbody>
        </table>
      </fieldset>

      <fieldset class="module aligned">
        <h2>{% trans "å‚™è€ƒ" %}</h2>
        <table class="remarks-table">
          <tbody>
            <tr>
              <th>{% trans "TELå‰ç‰¹è¨˜äº‹é …" %}</th>
              <td>{{ adminform.form.before_special_notes }}{{ adminform.form.before_special_notes.errors }}</td>
            </tr>
            <tr>
              <th>{% trans "TELå¾Œç‰¹è¨˜äº‹é …" %}</th>
              <td>{{ adminform.form.after_special_notes }}{{ adminform.form.after_special_notes.errors }}</td>
            </tr>
            <tr>
              <th>{% trans "åˆå›ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ—¥" %}</th>
              <td>{{ adminform.form.first_entry_date }}{{ adminform.form.first_entry_date.errors }}</td>
            </tr>
          </tbody>
        </table>
      </fieldset>

      <div class="submit-row">
        {% if change %}
          <input type="hidden" name="_continue" value="1">
        {% endif %}
        <input type="submit" class="btn-save" value="ä¿å­˜">
        <button type="submit" name="_save_back" class="btn-save-back">
          {% trans "ä¿å­˜ã—ã¦å‰ã®ç”»é¢ã«æˆ»ã‚‹" %}
        </button>
        {% if request.session.student_back_url %}
            <a href="{{ request.session.student_back_url }}" class="btn-back">
            {% trans "å‰ã®ç”»é¢ã«æˆ»ã‚‹" %}
          </a>
        {% endif %}
      </div>

    </form>
  </div>

  <script src="{% static 'admin/js/change_form.js' %}"></script>
{% endblock %}
